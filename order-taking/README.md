# 受注

```
ワークフロー 注文する =
  入力:
    注文フォーム
    商品カタログ
  出力:
    「注文が完了した」イベント or 正しくない注文
  副作用:
    顧客に注文の確認が送られる

  // step 1
  注文を検証する
  もし注文が正しくない場合は、正しくない注文を適切な書類の山に積む

  // step 2
  注文の価格を計算する

  // step 3
  注文の確認を顧客に送信する

  // step 4
  「注文が完了した」イベントを返す

サブステップ 注文を検証する =
  入力: 未検証の注文
  出力: 検証済みの注文 or 検証エラー
  依存: 商品コードが存在するかを確認する、住所が存在するかを確認する

  顧客の名前を検証する
  送信先住所と請求先住所が存在するかを確認する

  すべての注文行に対して、
    商品コードの形式が正しいかを確認する
    商品カタログに商品コードが存在するかを確認する

  もし全てに問題なければ、検証済みの注文を返す
  そうでなければ、検証エラーを返す

サブステップ 価格を計算する =
  入力: 検証された注文
  出力: 価格を計算した注文
  依存: 商品の価格を取得する

  注文行のそれぞれに対して
    商品の価格を取得し、注文行に価格を設定する
  請求金額（= 注文行の金額の合計）を設定する

サブステップ 注文確認書を顧客に送信する =
  入力: 価格が計算された注文、顧客情報
  出力: なし

  注文確認書を作成し、それを顧客に送信する
```

```
コンテキスト: 注文する

data 未検証の注文 =
  未検証の顧客情報
  and 未検証の送信先住所
  and 未検証の請求先住所
  and list of 未検証の注文行

data 検証済みの注文 =
  顧客情報
  and 送信先住所
  and 請求先住所
  and list of 注文行

data 価格が計算された注文 =
  顧客情報
  and 送信先住所
  and 請求先住所
  and list of 注文行
  and 請求金額

data 注文行 =
  商品
  and 数量
  and 価格

data 顧客情報 = unknown
data 請求先住所 = unknown

data ウィジェットコード = W+4桁の数字
data ギズモコード = G+3桁の数字
data 商品コード = ウィジェットコード or ギズモコード

data 単位数量 = 1から1000までの整数
data キログラム数量 = 0.05から100.00までの少数
data 注文数量 = 単位数量 and キログラム数量
```
